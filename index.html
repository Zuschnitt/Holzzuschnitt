<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Zuschnitt-Beleg</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1 {
      margin: 0;
      font-size: 1.8em;
    }

    img {
      height: auto;
      width: 150px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th {
      background-color: #f0f0f0;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }

    td:nth-child(1), td:nth-child(7) {
      background-color: #fffbe6; /* dezentes Gelb */
    }

    input {
      width: 100%;
      box-sizing: border-box;
    }

    #gesamt {
      font-weight: bold;
      font-size: 1.2em;
      text-align: right;
      margin-top: 10px;
    }

    #druck-button {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
    }

    @media print {
      #druck-button {
        display: none;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Zuschnitt-Beleg</h1>
    Toom_Baumarkt.png
  </header>

  <table>
    <thead>
      <tr>
        <th>Artikelnummer</th>
        <th>Stück</th>
        <th>Warenbezeichnung</th>
        <th>Länge (mm)</th>
        <th>Breite (mm)</th>
        <th>Stärke</th>
        <th>m²</th>
        <th>Preis pro m² (€)</th>
        <th>Gesamtpreis (€)</th>
      </tr>
    </thead>
    <tbody id="table-body">
      <script>
        for (let i = 0; i < 6; i++) {
          document.write(`
            <tr>
              <td><input type="text" oninput="loadData(this)"></td>
              <td><input type="number" min="1" value="1" oninput="recalculate(this)"></td>
              <td><input type="text" readonly></td>
              <td><input type="number" oninput="recalculate(this)"></td>
              <td><input type="number" oninput="recalculate(this)"></td>
              <td><input type="text" readonly></td>
              <td><input type="text" readonly></td>
              <td><input type="text" readonly></td>
              <td><input type="text" readonly></td>
            </tr>
          `);
        }
      </script>
    </tbody>
  </table>

  <div id="gesamt">Gesamtsumme: 0.00 €</div>
  <button id="druck-button" onclick="window.print()">Drucken</button>

  <script>
    let artikelData = {};

    fetch('artikel.json')
      .then(response => response.json())
      .then(data => {
        artikelData = data;
      })
      .catch(error => {
        console.error("Fehler beim Laden der artikel.json:", error);
      });

    function loadData(input) {
      const row = input.parentElement.parentElement;
      const artikelnummer = input.value.trim();
      const data = artikelData[artikelnummer];
      if (data) {
        row.cells[2].querySelector('input').value = data.bezeichnung;
        row.cells[5].querySelector('input').value = data.staerke;
        row.cells[7].querySelector('input').value = data.preis.toFixed(2);
        recalculate(input);
      } else {
        row.cells[2].querySelector('input').value = "";
        row.cells[5].querySelector('input').value = "";
        row.cells[7].querySelector('input').value = "";
        row.cells[6].querySelector('input').value = "";
        row.cells[8].querySelector('input').value = "";
      }
    }

    function recalculate(input) {
      const row = input.parentElement.parentElement;
      const stueck = parseFloat(row.cells[1].querySelector('input').value) || 0;
      const laenge = parseFloat(row.cells[3].querySelector('input').value) || 0;
      const breite = parseFloat(row.cells[4].querySelector('input').value) || 0;
      const preis = parseFloat(row.cells[7].querySelector('input').value) || 0;

      const qm = (laenge * breite) / 1000000;
      const gesamt = qm * preis * stueck;

      row.cells[6].querySelector('input').value = qm.toFixed(2);
      row.cells[8].querySelector('input').value = gesamt.toFixed(2);

      updateGesamtsumme();
    }

    function updateGesamtsumme() {
      let summe = 0;
      const rows = document.querySelectorAll("#table-body tr");
      rows.forEach(row => {
        const gesamt = parseFloat(row.cells[8].querySelector('input').value) || 0;
        summe += gesamt;
      });
      document.getElementById("gesamt").textContent = "Gesamtsumme: " + summe.toFixed(2) + " €";
    }
  </script>
</body>

